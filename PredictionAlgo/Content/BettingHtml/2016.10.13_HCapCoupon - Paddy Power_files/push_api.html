
<!-- saved from url=(0048)http://push.paddypower.com/push_api.html?v=1.5.5 -->
<html lang="en"><!-- AUTOGENERATED: DO NOT EDIT! --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
	<title>Push API</title>

	<script type="text/javascript">
	/* SWFObject v2.1 <http://code.google.com/p/swfobject/>
	Copyright (c) 2007-2008 Geoff Stearns, Michael Williams, and Bobby van der Sluis
	This software is released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
*/
var swfobject=function(){var b="undefined",Q="object",n="Shockwave Flash",p="ShockwaveFlash.ShockwaveFlash",P="application/x-shockwave-flash",m="SWFObjectExprInst",j=window,K=document,T=navigator,o=[],N=[],i=[],d=[],J,Z=null,M=null,l=null,e=false,A=false;var h=function(){var v=typeof K.getElementById!=b&&typeof K.getElementsByTagName!=b&&typeof K.createElement!=b,AC=[0,0,0],x=null;if(typeof T.plugins!=b&&typeof T.plugins[n]==Q){x=T.plugins[n].description;if(x&&!(typeof T.mimeTypes!=b&&T.mimeTypes[P]&&!T.mimeTypes[P].enabledPlugin)){x=x.replace(/^.*\s+(\S+\s+\S+$)/,"$1");AC[0]=parseInt(x.replace(/^(.*)\..*$/,"$1"),10);AC[1]=parseInt(x.replace(/^.*\.(.*)\s.*$/,"$1"),10);AC[2]=/r/.test(x)?parseInt(x.replace(/^.*r(.*)$/,"$1"),10):0}}else{if(typeof j.ActiveXObject!=b){var y=null,AB=false;try{y=new ActiveXObject(p+".7")}catch(t){try{y=new ActiveXObject(p+".6");AC=[6,0,21];y.AllowScriptAccess="always"}catch(t){if(AC[0]==6){AB=true}}if(!AB){try{y=new ActiveXObject(p)}catch(t){}}}if(!AB&&y){try{x=y.GetVariable("$version");if(x){x=x.split(" ")[1].split(",");AC=[parseInt(x[0],10),parseInt(x[1],10),parseInt(x[2],10)]}}catch(t){}}}}var AD=T.userAgent.toLowerCase(),r=T.platform.toLowerCase(),AA=/webkit/.test(AD)?parseFloat(AD.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,q=false,z=r?/win/.test(r):/win/.test(AD),w=r?/mac/.test(r):/mac/.test(AD);/*@cc_on q=true;@if(@_win32)z=true;@elif(@_mac)w=true;@end@*/return{w3cdom:v,pv:AC,webkit:AA,ie:q,win:z,mac:w}}();var L=function(){if(!h.w3cdom){return }f(H);if(h.ie&&h.win){try{K.write("<script id=__ie_ondomload defer=true src=//:><\/script>");J=C("__ie_ondomload");if(J){I(J,"onreadystatechange",S)}}catch(q){}}if(h.webkit&&typeof K.readyState!=b){Z=setInterval(function(){if(/loaded|complete/.test(K.readyState)){E()}},10)}if(typeof K.addEventListener!=b){K.addEventListener("DOMContentLoaded",E,null)}R(E)}();function S(){if(J.readyState=="complete"){J.parentNode.removeChild(J);E()}}function E(){if(e){return }if(h.ie&&h.win){var v=a("span");try{var u=K.getElementsByTagName("body")[0].appendChild(v);u.parentNode.removeChild(u)}catch(w){return }}e=true;if(Z){clearInterval(Z);Z=null}var q=o.length;for(var r=0;r<q;r++){o[r]()}}function f(q){if(e){q()}else{o[o.length]=q}}function R(r){if(typeof j.addEventListener!=b){j.addEventListener("load",r,false)}else{if(typeof K.addEventListener!=b){K.addEventListener("load",r,false)}else{if(typeof j.attachEvent!=b){I(j,"onload",r)}else{if(typeof j.onload=="function"){var q=j.onload;j.onload=function(){q();r()}}else{j.onload=r}}}}}function H(){var t=N.length;for(var q=0;q<t;q++){var u=N[q].id;if(h.pv[0]>0){var r=C(u);if(r){N[q].width=r.getAttribute("width")?r.getAttribute("width"):"0";N[q].height=r.getAttribute("height")?r.getAttribute("height"):"0";if(c(N[q].swfVersion)){if(h.webkit&&h.webkit<312){Y(r)}W(u,true)}else{if(N[q].expressInstall&&!A&&c("6.0.65")&&(h.win||h.mac)){k(N[q])}else{O(r)}}}}else{W(u,true)}}}function Y(t){var q=t.getElementsByTagName(Q)[0];if(q){var w=a("embed"),y=q.attributes;if(y){var v=y.length;for(var u=0;u<v;u++){if(y[u].nodeName=="DATA"){w.setAttribute("src",y[u].nodeValue)}else{w.setAttribute(y[u].nodeName,y[u].nodeValue)}}}var x=q.childNodes;if(x){var z=x.length;for(var r=0;r<z;r++){if(x[r].nodeType==1&&x[r].nodeName=="PARAM"){w.setAttribute(x[r].getAttribute("name"),x[r].getAttribute("value"))}}}t.parentNode.replaceChild(w,t)}}function k(w){A=true;var u=C(w.id);if(u){if(w.altContentId){var y=C(w.altContentId);if(y){M=y;l=w.altContentId}}else{M=G(u)}if(!(/%$/.test(w.width))&&parseInt(w.width,10)<310){w.width="310"}if(!(/%$/.test(w.height))&&parseInt(w.height,10)<137){w.height="137"}K.title=K.title.slice(0,47)+" - Flash Player Installation";var z=h.ie&&h.win?"ActiveX":"PlugIn",q=K.title,r="MMredirectURL="+j.location+"&MMplayerType="+z+"&MMdoctitle="+q,x=w.id;if(h.ie&&h.win&&u.readyState!=4){var t=a("div");x+="SWFObjectNew";t.setAttribute("id",x);u.parentNode.insertBefore(t,u);u.style.display="none";var v=function(){u.parentNode.removeChild(u)};I(j,"onload",v)}U({data:w.expressInstall,id:m,width:w.width,height:w.height},{flashvars:r},x)}}function O(t){if(h.ie&&h.win&&t.readyState!=4){var r=a("div");t.parentNode.insertBefore(r,t);r.parentNode.replaceChild(G(t),r);t.style.display="none";var q=function(){t.parentNode.removeChild(t)};I(j,"onload",q)}else{t.parentNode.replaceChild(G(t),t)}}function G(v){var u=a("div");if(h.win&&h.ie){u.innerHTML=v.innerHTML}else{var r=v.getElementsByTagName(Q)[0];if(r){var w=r.childNodes;if(w){var q=w.length;for(var t=0;t<q;t++){if(!(w[t].nodeType==1&&w[t].nodeName=="PARAM")&&!(w[t].nodeType==8)){u.appendChild(w[t].cloneNode(true))}}}}}return u}function U(AG,AE,t){var q,v=C(t);if(v){if(typeof AG.id==b){AG.id=t}if(h.ie&&h.win){var AF="";for(var AB in AG){if(AG[AB]!=Object.prototype[AB]){if(AB.toLowerCase()=="data"){AE.movie=AG[AB]}else{if(AB.toLowerCase()=="styleclass"){AF+=' class="'+AG[AB]+'"'}else{if(AB.toLowerCase()!="classid"){AF+=" "+AB+'="'+AG[AB]+'"'}}}}}var AD="";for(var AA in AE){if(AE[AA]!=Object.prototype[AA]){AD+='<param name="'+AA+'" value="'+AE[AA]+'" />'}}v.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+AF+">"+AD+"</object>";i[i.length]=AG.id;q=C(AG.id)}else{if(h.webkit&&h.webkit<312){var AC=a("embed");AC.setAttribute("type",P);for(var z in AG){if(AG[z]!=Object.prototype[z]){if(z.toLowerCase()=="data"){AC.setAttribute("src",AG[z])}else{if(z.toLowerCase()=="styleclass"){AC.setAttribute("class",AG[z])}else{if(z.toLowerCase()!="classid"){AC.setAttribute(z,AG[z])}}}}}for(var y in AE){if(AE[y]!=Object.prototype[y]){if(y.toLowerCase()!="movie"){AC.setAttribute(y,AE[y])}}}v.parentNode.replaceChild(AC,v);q=AC}else{var u=a(Q);u.setAttribute("type",P);for(var x in AG){if(AG[x]!=Object.prototype[x]){if(x.toLowerCase()=="styleclass"){u.setAttribute("class",AG[x])}else{if(x.toLowerCase()!="classid"){u.setAttribute(x,AG[x])}}}}for(var w in AE){if(AE[w]!=Object.prototype[w]&&w.toLowerCase()!="movie"){F(u,w,AE[w])}}v.parentNode.replaceChild(u,v);q=u}}}return q}function F(t,q,r){var u=a("param");u.setAttribute("name",q);u.setAttribute("value",r);t.appendChild(u)}function X(r){var q=C(r);if(q&&(q.nodeName=="OBJECT"||q.nodeName=="EMBED")){if(h.ie&&h.win){if(q.readyState==4){B(r)}else{j.attachEvent("onload",function(){B(r)})}}else{q.parentNode.removeChild(q)}}}function B(t){var r=C(t);if(r){for(var q in r){if(typeof r[q]=="function"){r[q]=null}}r.parentNode.removeChild(r)}}function C(t){var q=null;try{q=K.getElementById(t)}catch(r){}return q}function a(q){return K.createElement(q)}function I(t,q,r){t.attachEvent(q,r);d[d.length]=[t,q,r]}function c(t){var r=h.pv,q=t.split(".");q[0]=parseInt(q[0],10);q[1]=parseInt(q[1],10)||0;q[2]=parseInt(q[2],10)||0;return(r[0]>q[0]||(r[0]==q[0]&&r[1]>q[1])||(r[0]==q[0]&&r[1]==q[1]&&r[2]>=q[2]))?true:false}function V(v,r){if(h.ie&&h.mac){return }var u=K.getElementsByTagName("head")[0],t=a("style");t.setAttribute("type","text/css");t.setAttribute("media","screen");if(!(h.ie&&h.win)&&typeof K.createTextNode!=b){t.appendChild(K.createTextNode(v+" {"+r+"}"))}u.appendChild(t);if(h.ie&&h.win&&typeof K.styleSheets!=b&&K.styleSheets.length>0){var q=K.styleSheets[K.styleSheets.length-1];if(typeof q.addRule==Q){q.addRule(v,r)}}}function W(t,q){var r=q?"visible":"hidden";if(e&&C(t)){C(t).style.visibility=r}else{V("#"+t,"visibility:"+r)}}function g(s){var r=/[\\\"<>\.;]/;var q=r.exec(s)!=null;return q?encodeURIComponent(s):s}var D=function(){if(h.ie&&h.win){window.attachEvent("onunload",function(){var w=d.length;for(var v=0;v<w;v++){d[v][0].detachEvent(d[v][1],d[v][2])}var t=i.length;for(var u=0;u<t;u++){X(i[u])}for(var r in h){h[r]=null}h=null;for(var q in swfobject){swfobject[q]=null}swfobject=null})}}();return{registerObject:function(u,q,t){if(!h.w3cdom||!u||!q){return }var r={};r.id=u;r.swfVersion=q;r.expressInstall=t?t:false;N[N.length]=r;W(u,false)},getObjectById:function(v){var q=null;if(h.w3cdom){var t=C(v);if(t){var u=t.getElementsByTagName(Q)[0];if(!u||(u&&typeof t.SetVariable!=b)){q=t}else{if(typeof u.SetVariable!=b){q=u}}}}return q},embedSWF:function(x,AE,AB,AD,q,w,r,z,AC){if(!h.w3cdom||!x||!AE||!AB||!AD||!q){return }AB+="";AD+="";if(c(q)){W(AE,false);var AA={};if(AC&&typeof AC===Q){for(var v in AC){if(AC[v]!=Object.prototype[v]){AA[v]=AC[v]}}}AA.data=x;AA.width=AB;AA.height=AD;var y={};if(z&&typeof z===Q){for(var u in z){if(z[u]!=Object.prototype[u]){y[u]=z[u]}}}if(r&&typeof r===Q){for(var t in r){if(r[t]!=Object.prototype[t]){if(typeof y.flashvars!=b){y.flashvars+="&"+t+"="+r[t]}else{y.flashvars=t+"="+r[t]}}}}f(function(){U(AA,y,AE);if(AA.id==AE){W(AE,true)}})}else{if(w&&!A&&c("6.0.65")&&(h.win||h.mac)){A=true;W(AE,false);f(function(){var AF={};AF.id=AF.altContentId=AE;AF.width=AB;AF.height=AD;AF.expressInstall=w;k(AF)})}}},getFlashPlayerVersion:function(){return{major:h.pv[0],minor:h.pv[1],release:h.pv[2]}},hasFlashPlayerVersion:c,createSWF:function(t,r,q){if(h.w3cdom){return U(t,r,q)}else{return undefined}},removeSWF:function(q){if(h.w3cdom){X(q)}},createCSS:function(r,q){if(h.w3cdom){V(r,q)}},addDomLoadEvent:f,addLoadEvent:R,getQueryParamValue:function(v){var u=K.location.search||K.location.hash;if(v==null){return g(u)}if(u){var t=u.substring(1).split("&");for(var r=0;r<t.length;r++){if(t[r].substring(0,t[r].indexOf("="))==v){return g(t[r].substring((t[r].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(A&&M){var q=C(m);if(q){q.parentNode.replaceChild(M,q);if(l){W(l,true);if(h.ie&&h.win){M.style.display="block"}}M=null;l=null;A=false}}}}}();
	var flashvars = {
	};
	var params = {
		allowscriptaccess: "always",
		bgcolor:           "#ffffff"
	};
	var attributes = {
		id: "PSConManagerSWF"
	};
	swfobject.embedSWF("PSConManagerSWF.swf?v=1257249748", "PSConManagerSWF_container", "20", "10", "9.0.0", false, flashvars, params, attributes);
	</script><style type="text/css" media="screen">#PSConManagerSWF_container {visibility:hidden}</style>

	<script type="text/javascript">
function PSConFlash(e){this.method=e;this.listeners=[];this.connectCalled=false;this.server=null;this.rbuf="";this.respTimer=null;this.pingTimer=null;this.pongTimers=[];this.pingTimes=[];this.nextPingIdx=0;for(var t=0;t<10;t++){this.pongTimers.push(null);this.pingTimes.push(null)}if(e=="FLASH_SOCK_NATIVE"){this.sendTested=true;this.sendWorks=true}else{this.sendTested=false;this.sendWorks="n/a"}try{this.conId=PSConFlash.SWF.create(e);PSConFlash.consById[this.conId]=this}catch(n){this.conId="dummy"+PSConFlash.nextDummyId++}}function PSConAJAX(e){this.method=e;this.listeners=[];this.xmlreq=null;this.conId="ajaxcon"+PSConAJAX.nextConId++;this.connectCalled=false;this.server=null;this.rbuf="";this.responseTimer=null}function PSServer(e,t,n){this.host=e;this.port=t;this.method=n}function ps_servers_page_init(){try{PSConAJAX.pageInit()}catch(e){if(_debug)_debug("Could not initialise AJAX: "+e);ps_servers_blacklist_method("AJAX")}try{PSConFlash.pageInit()}catch(e){if(_debug)_debug("Could not initialise Flash: "+e);ps_servers_blacklist_method("FLASH_SOCK_NATIVE");ps_servers_blacklist_method("FLASH_SOCK_HTTP");ps_servers_blacklist_method("FLASH_URLSTREAM")}ps_servers_flash_ready_timer=window.setTimeout("ps_servers_check_flash_ready_by_now()",ps_servers_flash_ready_delay_ms)}function ps_servers_create_con(e){var t;if(e=="AJAX"){t=new PSConAJAX(e)}else{t=new PSConFlash(e)}if(_debug)_debug("Created connection "+t.conId);t.addListener(ps_servers_got_global_pscon_event);return t}function ps_servers_add(e,t,n){var r=false;for(var i=0;i<ps_servers_ranked_methods.length;i++){if(ps_servers_ranked_methods[i]==n){r=true;break}}if(!r){throw"Bad method "+n}ps_servers_available.splice(0,0,new PSServer(e,t,n));ps_servers_dispatch_list_change_event()}function ps_servers_remove(e,t,n){for(var r=0;r<ps_servers_available.length;r++){var i=ps_servers_available[r];if(i.host==e&&i.port==t&&i.method==n){break}}if(r==ps_servers_available.length){return}ps_servers_available.splice(r,1);ps_servers_dispatch_list_change_event();return}function ps_servers_recommend(){if(!ps_servers_available.length){throw"NONE";return}if(!ps_servers_sorted){ps_servers_sort_servers();ps_servers_sorted=true}if(!ps_servers_search_started_at){ps_servers_start_search()}if(ps_servers_still_searching){var e=(new Date).getTime()-ps_servers_search_started_at;if(e<ps_servers_fallback_delay_ms){throw"EAGAIN";return}if(_debug)_debug("Choosing fallback server for now.");return ps_servers_get_fallback()}else{return ps_servers_available[0]}}function ps_servers_add_server_list_listener(e){ps_servers_listeners.push(e)}function ps_servers_get_servers(){return[ps_servers_available.slice(0),ps_servers_blacklisted.slice(0)]}function ps_servers_dispatch_list_change_event(){for(var e=0;e<ps_servers_listeners.length;e++){try{ps_servers_listeners[e].call(null)}catch(t){if(_debug)_debug("Server list listener failed with: "+t)}}}function ps_servers_sort_servers(){for(var e=0;e<ps_servers_available.length;e++){var t=ps_servers_available[e];t.randomId=Math.random()}ps_servers_available.sort(ps_servers_cmp_servers);var n={};for(e=0;e<ps_servers_available.length;e++){var t=ps_servers_available[e];if(n[t.method]==undefined){n[t.method]=[t]}else{n[t.method].push(t)}}var r=[];while(true){var i=false;for(e=0;e<ps_servers_ranked_methods.length;e++){var s=ps_servers_ranked_methods[e];for(var o=0;o<ps_servers_test_next_method_after;o++){if(n[s]==undefined||!n[s].length){break}r.push(n[s][0]);n[s]=n[s].slice(1);if(n[s].length>0){i=true}}}if(!i){break}}ps_servers_available=r;ps_servers_dispatch_list_change_event()}function ps_servers_cmp_servers(e,t){if(e.randomId<t.randomId){return-1}else if(e.randomId>t.randomId){return+1}return 0}function ps_servers_got_global_pscon_event(e,t,n){if(ps_wrapper_talkback_url)ps_wrapper_send_talkback("got pscon event: "+e.conId+","+t+","+n);if(t=="DISCONNECTED"){var r=n;if(r=="UNSUPPORTED"){ps_servers_blacklist_method(e.server.method)}else if(r=="SECURITY"){ps_servers_demote_server(e.server)}else if(r=="ERROR"){ps_servers_demote_server(e.server)}}else if(t=="MESSAGE"){if(e.server.probablyGood==null){if(_debug)_debug("Marking "+e.server.debugStr()+" as probably good due to message received.");e.server.probablyGood=true}}}function ps_servers_blacklist_method(e){if(_debug)_debug("Blacklisting method "+e);ps_servers_methods_blacklisted[e]=true;var t=[];for(var n=0;n<ps_servers_available.length;n++){var r=ps_servers_available[n];if(r.method==e){ps_servers_blacklisted.push(r)}else{t.push(r)}}ps_servers_available=t;ps_servers_dispatch_list_change_event()}function ps_servers_blacklist_server(e){if(_debug)_debug("Blacklisting server "+e.debugStr());var t=[];for(var n=0;n<ps_servers_available.length;n++){var r=ps_servers_available[n];if(r!=e){t.push(r)}else{ps_servers_blacklisted.push(r)}}ps_servers_available=t;ps_servers_dispatch_list_change_event()}function ps_servers_demote_server(e){if(_debug)_debug("Demoting server "+e.debugStr());e.probablyGood=null;var t=[];var n=false;for(var r=0;r<ps_servers_available.length;r++){var i=ps_servers_available[r];if(i!=e){t.push(i)}else{n=true}}ps_servers_available=t;if(n){ps_servers_available.push(e)}ps_servers_dispatch_list_change_event()}function ps_servers_start_search(){ps_servers_search_started_at=(new Date).getTime();ps_servers_still_searching=true;ps_servers_search_next_step()}function ps_servers_search_next_step(){var e=(new Date).getTime()-ps_servers_search_started_at;if(e>ps_servers_test_max_time_ms){if(_debug)_debug("Abandoning search for servers after "+e+"ms.");return}var t=false;for(var n=0;n<ps_servers_available.length;n++){var r=ps_servers_available[n];if(ps_servers_power_methods[r.method]!=undefined){t=true;break}}if(!t){if(_debug)_debug("Stopping search - no power servers available.");ps_servers_still_searching=false;return}if(r.method.match(/^FLASH/)&&!PSConFlash.isReady()){if(_debug)_debug("Waiting for flash before testing server "+r.debugStr());ps_servers_search_timer=window.setTimeout("ps_servers_search_next_step()",250);return}if(_debug)_debug("Testing server "+r.debugStr());ps_servers_test_con=ps_servers_create_con(r.method);var i=ps_protocol_fmt_connect_req("AJAX")+ps_protocol_fmt_ping_req(1);ps_servers_test_con.addListener(ps_servers_got_test_pscon_event);ps_servers_test_con.connect(r,i)}function ps_servers_got_test_pscon_event(e,t,n){if(e!=ps_servers_test_con){if(_debug)_debug("Ignoring event from previous test connection.");return}if(_debug)_debug("Got event on test server connection "+t+", "+n);if(t=="DISCONNECTED"){var r=n;if(ps_servers_still_searching){ps_servers_search_timer=window.setTimeout("ps_servers_search_next_step()",500)}}else if(t=="MESSAGE"){if(_debug)_debug("Found working power server - can stop search.");ps_servers_still_searching=false}}function ps_servers_get_fallback(){if(!ps_servers_available.length){throw"NONE"}for(var e=0;e<ps_servers_available.length;e++){var t=ps_servers_available[e];if(ps_servers_fallback_methods[t.method]!=undefined){return t}}if(ps_servers_available.length>1){if(_debug)_debug("Could not find any fallback servers - picking 2nd.");return ps_servers_available[1]}else{if(_debug)_debug("Could not find any fallback servers - picking 1st.");return ps_servers_available[0]}}function ps_servers_check_flash_ready_by_now(){if(!PSConFlash.isReady()){if(_debug)_debug("Flash still not ready - blacklisting.");ps_servers_blacklist_method("FLASH_SOCK_NATIVE");ps_servers_blacklist_method("FLASH_SOCK_HTTP");ps_servers_blacklist_method("FLASH_URLSTREAM")}}function ps_servers_shutdown(){try{window.cancelTimeout(ps_servers_search_timer)}catch(e){}try{window.cancelTimeout(ps_servers_flash_ready_timer)}catch(e){}}function PSPongResponse(e){this.type="PONG";this.ping_id=e}function PSPublishedMsg(e,t,n,r,i){this.type="MSG";this.channel=e;this.msg_id=t;this.user_id=n;this.subject=r;this.data=i;this.channel_level=this.channel.substring(0,6);this.channel_id=parseInt(this.channel.substring(7),10);this.subject_level=this.subject.substring(0,6);this.subject_id=parseInt(this.subject.substring(7),10)}function ps_protocol_validate_channel(e){return ps_protocol_CHANNEL_PATTERN.test(e)}function ps_protocol_fmt_connect_req(e,t){var n="C";switch(e){case"FLASH_SOCK_NATIVE":{n+="P";break};case"FLASH_SOCK_HTTP":{n+="P";break};case"FLASH_URLSTREAM":{n+="L";break};case"AJAX":{n+="L";break};default:{throw"Unsupported method "+e;break}}if(!t){t=""}n+=ps_protocol_fmt_dec_digits(t.length,ps_protocol_AUTH_SIZE);n+=t;return n}function ps_protocol_fmt_subscribe_req(e,t){var n="S";n+=ps_protocol_fmt_channels(e,4);n+=ps_protocol_fmt_msg_id(t);return n}function ps_protocol_fmt_publish_req(e,t,n,r){var i="P";i+=ps_protocol_fmt_channels(e,1);i+=ps_protocol_fmt_msg_id(t);if(!ps_protocol_validate_channel(n)){throw"Bad subject '"+n+"'."}i+=n;var s=ps_protocol_utf_len(r);i+=ps_protocol_fmt_hex_digits(s,ps_protocol_MSG_LENGTH_SIZE);i+=r;return i}function ps_protocol_fmt_unsubscribe_req(e){var t="U";t+=ps_protocol_fmt_channels(e,4);return t}function ps_protocol_fmt_delete_req(e,t){var n="D";n+=ps_protocol_fmt_channels(e,1);if(!ps_protocol_validate_channel(t)){throw"Bad subject '"+t+"'."}n+=t;return n}function ps_protocol_fmt_ping_req(e){return"p"+ps_protocol_fmt_dec_digits(e,ps_protocol_PING_ID_SIZE)}function ps_protocol_parse_msg(e,t){var n=e.length;if(n-t<1){return[0,null,null]}var r=e.charAt(t);switch(r){case"g":{return ps_protocol_parse_pong_msg(e,t)};case"M":{return ps_protocol_parse_published_msg(e,t)};default:{if(_debug)_debug("Unexpected message type "+r)}}return[-1,null,null]}function ps_protocol_fmt_msg_id(e){if(!e.match(/^[!-u]*$/)){throw"not a base 85 msg_id"}if(e.length>ps_protocol_MESSAGE_ID_SIZE){throw"Bad msg_id '"+e+"'; longer than "+ps_protocol_MESSAGE_ID_SIZE+" chars."}while(e.length<ps_protocol_MESSAGE_ID_SIZE){e="!"+e}return e}function ps_protocol_next_msg_id(e){e=ps_protocol_fmt_msg_id(e);var t="!".charCodeAt(0);for(var n=ps_protocol_MESSAGE_ID_SIZE-1;n>=0;n--){var r=e.charCodeAt(n)-t;r++;if(r<85){e=e.substr(0,n)+String.fromCharCode(t+r)+e.substr(n+1);break}else{r=0;e=e.substr(0,n)+String.fromCharCode(t+r)+e.substr(n+1)}}if(n<0){throw"msg_id overflow"}return e}function ps_protocol_parse_pong_msg(e,t){var n=e.length;var r;if(n-t<1+ps_protocol_PING_ID_SIZE){return[0,null,null]}var i=e.charAt(t);t++;if(i!="g"){if(_debug)_debug("Pong msg has bad msg_type "+i);return[-1,null,null]}try{r=ps_protocol_parse_dec_digits(e,t,ps_protocol_PING_ID_SIZE)}catch(s){if(_debug)_debug("Invalid ping id");return[-1,null,null]}var o=r[0];t=r[1];var u=new PSPongResponse(o);return[1,t,u]}function ps_protocol_parse_published_msg(e,t){var n=e.length;var r;var i=1+ps_protocol_CHANNEL_ID_SIZE+ps_protocol_MESSAGE_ID_SIZE+1+ps_protocol_CHANNEL_ID_SIZE+ps_protocol_MSG_LENGTH_SIZE*2;if(n-t<i){return[0,null,null]}var s=e.charAt(t);t++;if(s!="M"){if(_debug)_debug("Published msg has bad msg_type "+s);return[-1,null,null]}var o=t+ps_protocol_CHANNEL_ID_SIZE+ps_protocol_MESSAGE_ID_SIZE;var u=0;var a=1;var f=e.charAt(o);if(f=="G"){}else if(f=="U"){a=1+ps_protocol_USER_ID_SIZE;if(o+a>=n){return[0,null,null]}try{r=ps_protocol_parse_dec_digits(e,o+1,ps_protocol_USER_ID_SIZE)}catch(l){if(_debug)_debug("Invalid user_id.");return[-1,null,null]}u=r[0]}else{if(_debug)_debug("Bad from type; should be G or U.");return[-1,null,null]}var c=t+ps_protocol_CHANNEL_ID_SIZE+ps_protocol_MESSAGE_ID_SIZE+a+ps_protocol_CHANNEL_ID_SIZE+ps_protocol_MSG_LENGTH_SIZE;if(c>=n){return[0,null,null]}try{r=ps_protocol_parse_hex_digits(e,c,ps_protocol_MSG_LENGTH_SIZE)}catch(l){if(_debug)_debug("Invalid message length.");return[-1,null,null]}var h=r[0];var p=r[1];if(_debug)_debug("Found body length of "+h+" codepoints");if(n-p<h){return[0,null,null]}try{r=ps_protocol_parse_channel(e,t)}catch(l){if(_debug)_debug("Invalid channel");return[-1,null,null]}var d=r[0];t=r[1];try{r=ps_protocol_parse_msg_id(e,t)}catch(l){if(_debug)_debug("Invalid message id");return[-1,null,null]}var v=r[0];t=r[1];t+=a;try{r=ps_protocol_parse_channel(e,t)}catch(l){if(_debug)_debug("Invalid subject");return[-1,null,null]}var m=r[0];t=r[1];var g=e.substr(p,h);t=p+h;var y=new PSPublishedMsg(d,v,u,m,g);return[1,t,y]}function ps_protocol_parse_channel(e,t){if(t+ps_protocol_CHANNEL_ID_SIZE>e.length){throw"too short"}var n=e.substr(t,ps_protocol_CHANNEL_ID_SIZE);if(!ps_protocol_validate_channel(n)){throw"bad channel id"}return[n,t+ps_protocol_CHANNEL_ID_SIZE]}function ps_protocol_parse_dec_digits(e,t,n){if(t+n>e.length){throw"too short"}var r=e.substr(t,n);if(!r.match(/^[0-9]+$/)){throw"not a number"}r=parseInt(r,10);if(isNaN(r)||r<0){throw"not a number"}return[r,t+n]}function ps_protocol_parse_hex_digits(e,t,n){if(t+n>e.length){throw"too short"}var r=e.substr(t,n);if(!r.match(/^[0-9a-fA-F]+$/)){throw"not a number"}r=parseInt(r,16);if(isNaN(r)||r<0){throw"not a number"}return[r,t+n]}function ps_protocol_parse_msg_id(e,t){var n=ps_protocol_MESSAGE_ID_SIZE;if(t+n>e.length){throw"too short"}var r=e.substr(t,n);if(!r.match(/^[!-u]+$/)){throw"not a base 85 msg_id"}return[r,t+n]}function ps_protocol_utf_len(e){var t=0;for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<=127){t+=1}else if(r<=2047){t+=2}else if(r<=65535){t+=3}else if(r<=1114111){t+=4}else{throw"Bad Unicode codepoint "+r}}return t}function ps_protocol_advance_bytes(e,t,n){var r=0;var i=t;while(r<n&&i<e.length){var s=e.charCodeAt(i);if(s<=127){r+=1}else if(s<=2047){r+=2}else if(s<=65535){r+=3}else if(s<=1114111){r+=4}else{throw"Bad Unicode codepoint "+s}i++}if(r<n){return-1}else if(r>n){throw"Cannot advance into middle of UTF-8 multi-byte sequence."}return i}function ps_protocol_fmt_dec_digits(e,t){var n=parseInt(e,10);if(isNaN(n)){throw"Bad id '"+e+"'; should be an integer."}var r=""+n;if(r.length>t){throw"Bad id '"+e+"'; longer than "+t+" digits."}while(r.length<t){r="0"+r}return r}function ps_protocol_fmt_hex_digits(e,t){var n=parseInt(e,10);if(isNaN(n)){throw"Bad id '"+e+"'; should be an integer."}var r=n.toString(16);if(r.length>t){throw"Bad id '"+e+"'; longer than "+t+" digits."}while(r.length<t){r="0"+r}return r}function ps_protocol_fmt_channels(e,t){var n="";var r=e.length;if(!r){throw"Bad number of channels."}try{n+=ps_protocol_fmt_dec_digits(r,t)}catch(i){throw"Bad number of channels."}for(var s=0;s<r;s++){var o=e[s];if(!ps_protocol_validate_channel(o)){throw"Bad channel '"+o+"'."}n+=o}return n}function ps_client_add_server(e,t,n){ps_servers_add(e,t,n)}function ps_client_add_msg_listener(e){_ps_client_msg_listeners.push(e)}function ps_client_del_msg_listener(e){var t=[];for(var n=0;n<_ps_client_msg_listeners.length;n++){if(_ps_client_msg_listeners[n]!=e){t.push(_ps_client_msg_listeners[n])}}_ps_client_msg_listeners=t}function ps_client_add_state_listener(e){if(!_ps_client_state_listeners.length){ps_servers_add_server_list_listener(function(){_ps_client_notify_state_change("SERVERS")})}_ps_client_state_listeners.push(e)}function ps_client_start(){if(_ps_client_started){return}_ps_client_started=true;_ps_client_status="DISCONNECTED";_ps_client_notify_state_change("STATUS");ps_client_reconnect()}function ps_client_set_auth_token(e){_ps_client_auth_token=e;if(_ps_client_started){ps_client_reconnect()}}function ps_client_subscribe(e,t){t=ps_protocol_fmt_msg_id(t);var n=[];var r=[];for(var i=0;i<e.length;i++){var s=e[i];if(!ps_protocol_validate_channel(s)){if(_debug)_debug("Bad channel "+s);throw"Bad channel "+s}if(_ps_client_channels[s]==undefined){if(_debug)_debug("Subscribing to "+s+" (last msg_id = "+t+").");r.push(s);_ps_client_channels[s]={last_msg_id:t,ref_count:1}}else{_ps_client_channels[s].ref_count++;var o=_ps_client_channels[s].last_msg_id;if(t<o){if(_debug)_debug("Re-subscribing to "+s+" (last msg_id = "+t+" is lower than"+" existing_last msg_id = "+o+").");n.push(s);r.push(s);_ps_client_channels[s].last_msg_id=t}else{if(_debug)_debug("Already subscribed to "+s+".")}}}_ps_client_notify_sub_change();if(r.length&&_ps_client_started){var u="";if(n.length){u+=ps_protocol_fmt_unsubscribe_req(n)}u+=ps_protocol_fmt_subscribe_req(r,t);ps_client_send_data(u,true)}return}function ps_client_smart_sub(e){throw"ps_client_smart_sub has been obsoleted"}function ps_client_unsubscribe(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n];if(_ps_client_channels[r]!=undefined){_ps_client_channels[r].ref_count--;if(_ps_client_channels[r].ref_count<=0){delete _ps_client_channels[r];t.push(r);if(_debug)_debug("Unsubscribing from "+r)}}}_ps_client_notify_sub_change();if(t.length&&_ps_client_started){var i=ps_protocol_fmt_unsubscribe_req(t);ps_client_send_data(i,true)}return}function ps_client_replace_subs(e,t,n){n=ps_protocol_fmt_msg_id(n);if(e.length){ps_client_unsubscribe(e)}if(t.length){ps_client_subscribe(t,n)}}function ps_client_register(e,t,n,r){ps_client_deregister(e);var i={handler:t,channels:n.slice(),last_msgs:{}};for(var s=0;s<n.length;s++){i.last_msgs[n[s]]=r}_ps_client_registrants[e]=i;if(_ps_client_num_registrants==0){ps_client_add_msg_listener(_ps_client_notify_registrants)}_ps_client_num_registrants++;ps_client_subscribe(n,r)}function ps_client_deregister(e){var t=_ps_client_registrants[e];if(!t)return;delete _ps_client_registrants[e];ps_client_unsubscribe(t.channels);_ps_client_num_registrants--;if(_ps_client_num_registrants==0){ps_client_del_msg_listener(_ps_client_notify_registrants)}}function ps_client_publish(e,t,n,r){if(_debug)_debug("Publishing message "+t);var i=ps_protocol_fmt_publish_req(e,t,n,r);ps_client_send_data(i,false);return}function ps_client_delete(e,t){if(_debug)_debug("Deleting message re: "+t);var n=ps_protocol_fmt_delete_req(e,t);ps_client_send_data(n,false);return}function ps_client_is_subscribed_to(e){if(_ps_client_channels[e]!=undefined){return _ps_client_channels[e].ref_count}else{return 0}}function ps_client_get_last_msg_id(e){if(_ps_client_channels[e]!=undefined){return _ps_client_channels[e].last_msg_id}else{return ps_protocol_fmt_msg_id("")}}function ps_client_page_init(){ps_servers_page_init()}function ps_client_reconnect(){if(!_ps_client_started){if(_debug)_debug("Refusing to connect until ps_client_start called.");return}if(_ps_client_recon_timer){if(_debug)_debug("Waiting for re-connection timer");return}if(_debug)_debug("Client reconnecting.");var e;try{e=ps_servers_recommend()}catch(t){if(t=="EAGAIN"){if(_debug)_debug("No server recommendation available yet; "+"will retry shortly.");_ps_client_recon_timer=window.setTimeout("_ps_client_recon_timer=null;ps_client_reconnect()",250);return}else{alert("Unable to find any push servers ("+t+").");return}}if(_debug)_debug("Client closing any existing connection.");ps_client_disconnect();if(_debug)_debug("Client opening connection to "+e.debugStr());_ps_client_con=ps_servers_create_con(e.method);ps_wrapper_send_talkback("Client opened connection to "+e.debugStr()+" as "+_ps_client_con.conId);var n=_ps_client_get_onconnect_data(e.method);_ps_client_wbuf_pending=_ps_client_wbuf.length;_ps_client_con.addListener(_ps_client_got_pscon_event);_ps_client_status="CONNECTING";_ps_client_notify_state_change("STATUS");_ps_client_con.connect(e,n);return}function ps_client_disconnect(){if(_debug)_debug("Client told to disconnect.");_ps_client_status="DISCONNECTED";_ps_client_notify_state_change("STATUS");if(_ps_client_recon_timer!=null){window.clearTimeout(_ps_client_recon_timer)}if(_ps_client_con){_ps_client_con.disconnect();_ps_client_con=null}}function ps_client_get_debug_status(){var e="";e+="Server: ";if(_ps_client_con&&_ps_client_con.server){e+=_ps_client_con.server.debugStr()}else{e+="None"}e+=", ";e+="Status: "+(_ps_client_status?_ps_client_status:"none")+"";return e}function ps_client_add_sub_listener(e){_ps_client_sub_listeners.push(e)}function ps_client_get_subs(){var e=[];for(var t in _ps_client_channels){e.push([t,_ps_client_channels[t].last_msg_id])}return e}function ps_client_set_last_msg_id(e,t){t=ps_protocol_fmt_msg_id(t);if(_ps_client_channels[e]!=undefined){_ps_client_channels[e].last_msg_id=t;_ps_client_notify_sub_change()}else{}}function ps_client_send_data(e,t){if(_ps_client_con&&_ps_client_con.sendData(e)){return true}else{if(!t){_ps_client_wbuf+=e}ps_client_reconnect();return false}}function _ps_client_got_pscon_event(e,t,n){if(e!=_ps_client_con){ps_wrapper_send_talkback("Client got event on old connection");if(_debug)_debug("Client got event on old connection.");try{e.disconnect()}catch(r){if(_debug)_debug("Failed to clean up old connection.")}return}if(_debug)_debug("Client got event on current connection: "+t+","+n);if(ps_wrapper_talkback_url)ps_wrapper_send_talkback("Client got event on current connection: "+t+","+n);switch(t){case"CONNECTED":{_ps_client_status="CONNECTED";_ps_client_notify_state_change("STATUS");_ps_client_wbuf=_ps_client_wbuf.substring(_ps_client_wbuf_pending);_ps_client_wbuf_pending=0;break};case"DISCONNECTED":{_ps_client_status="DISCONNECTED";_ps_client_notify_state_change("STATUS");_ps_client_con=null;var i=n;if(i!="DELIBERATE"&&_ps_client_recon_delay_ms>0){if(_debug)_debug("Will reconnect in "+_ps_client_recon_delay_ms+"ms.");_ps_client_recon_timer=window.setTimeout("_ps_client_recon_timer=null;ps_client_reconnect()",_ps_client_recon_delay_ms)}break};case"MESSAGE":{_ps_client_got_msg(n);break};default:{if(_debug)_debug("Client got unknown event: "+t);break}}}function _ps_client_got_msg(e){if(_debug)_debug("Got message: "+e.debugStr());if(ps_wrapper_talkback_url)ps_wrapper_send_talkback("Got message: "+e.debugStr());if(e.type!="MSG"){return}var t=e.channel;var n=e.msg_id;if(!ps_client_is_subscribed_to(t)){if(_debug)_debug("Ignoring msg #"+n+" since not subscribed to channel "+t)}else if(n<=ps_client_get_last_msg_id(t)){if(_debug)_debug("Ignoring msg #"+n+" since no newer than last message for channel "+t)}else{ps_client_set_last_msg_id(t,e.msg_id);for(var r=0;r<_ps_client_msg_listeners.length;r++){try{_ps_client_msg_listeners[r](e)}catch(i){_ps_client_last_msg_handler_err_msg=i;_ps_client_last_msg_handler_err_fn=_ps_client_msg_listeners[r];if(_debug)_debug("Client msg listener failed with: "+i);if(ps_wrapper_talkback_url)ps_wrapper_send_talkback("Client msg listener failed with: "+i)}}}}function _ps_client_notify_registrants(e){var t=[];for(var n in _ps_client_registrants){var r=_ps_client_registrants[n];var i=r.last_msgs[e.channel];if(i==undefined||e.msg_id<i){continue}r.last_msgs[e.channel]=e.msg_id;try{r.handler(e)}catch(s){t.push(n+" threw "+s)}}if(t.length){throw t.join(", ")}}function _ps_client_notify_sub_change(){_ps_client_cached_subs_req=null;_ps_client_notify_state_change("SUBS")}function _ps_client_notify_state_change(e){for(var t=0;t<_ps_client_state_listeners.length;t++){try{_ps_client_state_listeners[t](e)}catch(n){if(_debug)_debug("Client state listener failed: "+n.toString?n.toString():n)}}}function _ps_client_get_subs_reqs(){var e=ps_client_get_subs();var t={};for(var n=0;n<e.length;n++){var r=e[n][0];var i=e[n][1];if(t[i]==undefined){t[i]=[r]}else{t[i].push(r)}}var s=[];for(var i in t){var o=t[i];s.push(ps_protocol_fmt_subscribe_req(o,i))}return s}function _ps_client_get_onconnect_data(e){var t=ps_protocol_fmt_connect_req(e,_ps_client_auth_token);if(!_ps_client_cached_subs_req){_ps_client_cached_subs_req=_ps_client_get_subs_reqs().join("")}return t+_ps_client_cached_subs_req+_ps_client_wbuf}function ps_wrapper_send_talkback(e){if(!ps_wrapper_talkback_url)return;window.setTimeout("ps_wrapper_send_talkback_real('"+escape(e)+"');",1)}function ps_wrapper_send_talkback_real(e){var t=new Image;t.src=ps_wrapper_talkback_url+"_"+e}function ps_wrapper_page_init(){var e=document.getElementById("ps_wrapper_debug_ta");if(e!=null){_debug=ps_wrapper_debug;ps_wrapper_clear_debug();var t=document.getElementById("ps_wrapper_debug_enabled_checkbox");t.checked=true}else{_debug=null}if(_debug)_debug("Iframe initialising");if(ps_wrapper_talkback_url)ps_wrapper_send_talkback("Iframe initialising");ps_wrapper_drop_domain();ps_client_page_init();if(_debug)_debug("Iframe initialised");_ps_wrapper_parent_timed_out=false;_ps_wrapper_parent_timer=window.setTimeout("ps_wrapper_give_up_on_parent()",_ps_wrapper_parent_timeout_ms);window.setTimeout("ps_wrapper_tell_parent_ready()",1);return}function ps_wrapper_drop_domain(){try{var e=document.domain;if(e.match(_ps_wrapper_drop_domain_for_re)==null){return}var t=e.indexOf(".");var n=e.substr(t+1);document.domain=n}catch(r){if(_debug)_debug("Warning: could not drop iframe domain from "+e+" to "+n+".")}return}function ps_wrapper_tell_parent_ready(){if(_ps_wrapper_parent_timed_out){return}try{parent.push_ready()}catch(e){_ps_wrapper_last_parent_err=e;if(_debug)_debug("Waiting for parent..."+e);if(ps_wrapper_talkback_url)ps_wrapper_send_talkback("Waiting for parent..."+e);window.setTimeout("ps_wrapper_tell_parent_ready()",500);return}window.clearTimeout(_ps_wrapper_parent_timer);_ps_wrapper_parent_timer=null;if(_debug)_debug("Parent informed iframe is ready.");if(ps_wrapper_talkback_url)ps_wrapper_send_talkback("Parent informed iframe is ready.");return}function ps_wrapper_give_up_on_parent(){if(_ps_wrapper_parent_timer==null){return}if(_debug)_debug("Giving up on parent frame.");_ps_wrapper_parent_timed_out=true;return}function ps_wrapper_page_shutdown(){try{ps_client_disconnect()}catch(e){}try{ps_servers_shutdown()}catch(e){}try{parent.push_shutdown()}catch(e){}}function ps_wrapper_debug(e){var t=document.getElementById("ps_wrapper_debug_ta");t.value+=""+e+"\n";if(t.value.length>_ps_wrapper_max_debug_scollback_chars*1.1){t.value=t.value.substring(t.value.length-_ps_wrapper_max_debug_scollback_chars)}t.scrollTop=t.scrollHeight}function ps_wrapper_clear_debug(){var e=document.getElementById("ps_wrapper_debug_ta");e.value=""}function ps_wrapper_set_debug_enabled(e){if(e){_debug=ps_wrapper_debug}else{_debug=null}}PSConFlash.JSReady=false;PSConFlash.SWFReady=false;PSConFlash.SWF=null;PSConFlash.consById={};PSConFlash.eventQ=[];PSConFlash.pingInterval=15*1e3;PSConFlash.pongTimeout=20*1e3;PSConFlash.respTimeout=240*1e3;PSConFlash.nextDummyId=0;PSConFlash.pingBaseId=9e3;PSConFlash.pageInit=function(){if(typeof _debug=="function")_debug("Performing page initialisation for Flash.");PSConFlash.JSReady=true};PSConFlash.isReady=function(){return PSConFlash.SWFReady};PSConFlash.prototype.connect=function(e,t){if(typeof _debug=="function")_debug("Connecting "+this.conId+" to "+e.debugStr());if(this.conId.match(/^dummy/)){if(typeof _debug=="function")_debug("Cannot connect "+this.conId+" to "+e.debugStr()+" could not create flash connection yet.");this.gotEvent("DISCONNECTED","ERROR");return}if(this.connectCalled){if(_debug)_debug("Cannot connect "+this.conId+"; already called connect().");this.disconnect("ERROR");return}this.connectCalled=true;if(e.method!=this.method){if(_debug)_debug("Cannot connect "+this.conId+" to "+e.debugStr()+" with a "+this.method+" connection.");this.disconnect("ERROR");return}this.server=e;if(typeof _debug=="function")_debug('Sending initial data "'+t+'" on '+this.conId);PSConFlash.SWF.connect(this.conId,e.host,e.port,t)};PSConFlash.prototype.disconnect=function(e){if(!e){e="DELIBERATE"}if(typeof _debug=="function")_debug("Disconnecting "+this.conId+" due to "+e);PSConFlash.SWF.disconnect(this.conId,e)};PSConFlash.prototype.sendData=function(e,t){if(this.sendTested&&!this.sendWorks){return false}if(!this.sendTested&&!t){return false}if(typeof _debug=="function")_debug("Sending data "+e+" on "+this.conId);var n=PSConFlash.SWF.sendData(this.conId,e);if(n){if(_debug)_debug("Sent data on "+this.conId)}else{if(typeof _debug=="function")_debug("Failed to send data on "+this.conId)}return n};PSConFlash.prototype.addListener=function(e){this.listeners.push(e)};PSConFlash.isJSReady=function(){if(typeof _debug=="function")_debug("Flash asking if JS is ready => "+PSConFlash.JSReady);return PSConFlash.JSReady};PSConFlash.setSWFReady=function(){if(typeof _debug=="function")_debug("Flash has set its callbacks.");PSConFlash.SWFReady=true;var e="PSConManagerSWF";if(navigator.appName.indexOf("Microsoft")!=-1){PSConFlash.SWF=window[e]}else{PSConFlash.SWF=document[e]}if(!PSConFlash.SWF){if(typeof _debug=="function")_debug("Could not find flash movie");PSConFlash.SWFReady=false;return}return};PSConFlash.gotSWFEvent=function(e,t,n){if(typeof _debug=="function")_debug("Got event from flash: "+e+","+t+","+n);if(t=="DEBUG")return;var r=PSConFlash.consById[e];if(r==undefined){return}else{try{r.gotEvent(t,n)}catch(i){if(typeof _debug=="function")_debug("Failed to process event on "+e+" : "+(i.toString?i.toString():i));r.disconnect("ERROR")}}};PSConFlash.sendPing=function(e){var t=PSConFlash.consById[e];if(t==undefined){return}if(t.sendTested&&!t.sendWorks){return}if(typeof _debug=="function")_debug("Queued another ping in "+PSConFlash.pingInterval);if(this.pingTimer!=null){window.clearTimeout(this.pingTimer)}var n="PSConFlash.sendPing('"+e+"')";this.pingTimer=window.setTimeout(n,PSConFlash.pingInterval);var r=t.nextPingIdx;t.nextPingIdx++;if(t.nextPingIdx==t.pongTimers.length){t.nextPingIdx=0}var i=PSConFlash.pingBaseId+r;if(t.pongTimers[r]!=null){if(typeof _debug=="function")_debug("Pong buffer full for "+e);t.disconnect("ERROR");return}n="PSConFlash.noPong('"+t.conId+"', "+r+")";t.pongTimers[r]=window.setTimeout(n,PSConFlash.pongTimeout);t.pingTimes[r]=(new Date).valueOf();if(typeof _debug=="function")_debug("Sending ping id = "+i+" on "+e);t.sendData(ps_protocol_fmt_ping_req(i),true);return};PSConFlash.noPong=function(e,t){if(typeof _debug=="function")_debug("No pong for pingIdx = "+t+" on "+e);var n=PSConFlash.consById[e];if(n==undefined){return}if(!n.sendTested||!n.sendWorks){if(typeof _debug=="function")_debug("Sending not working on "+e);n.sendTested=true;n.sendWorks=false;if(n.respTimer==null){if(typeof _debug=="function")_debug("Starting response timer on "+e);var r="PSConFlash.noResp('"+n.conId+"')";n.respTimer=window.setTimeout(r,PSConFlash.respTimeout)}if(n.pingTimer!=null){window.clearTimeout(n.pingTimer);n.pingTimer=null}for(var i=0;i<n.pongTimers.length;i++){if(n.pongTimers[i]!=null){window.clearTimeout(n.pongTimers[i])}}}else{n.disconnect("ERROR")}};PSConFlash.noResp=function(e){if(typeof _debug=="function")_debug("Response timeout expired on "+e);var t=PSConFlash.consById[e];if(t==undefined){return}t.disconnect("ERROR")};PSConFlash.prototype.startPings=function(){if(this.pingTimer!=null){window.clearTimeout(this.pingTimer);this.pingTimer=null}if(this.sendTested&&!this.sendWorks){return}var e;if(!this.sendTested){e=1}else{e=PSConFlash.pingInterval}var t="PSConFlash.sendPing('"+this.conId+"')";this.pingTimer=window.setTimeout(t,e);return};PSConFlash.prototype.gotPong=function(e){if(typeof _debug=="function")_debug("Got pong id = "+e+" on "+this.conId);if(!this.sendTested){this.sendTested=true;this.sendWorks=true}var t=e-PSConFlash.pingBaseId;if(t<0||t>this.pongTimers.length){return false}var n=this.pongTimers[t];if(n!=null){window.clearTimeout(n);this.pongTimers[t]=null}var r=this.pingTimes[t];var i=(new Date).valueOf();var s="UNKNOWN";if(r){this.pingTimes[t]=null;s=i-r}else{r="UKNOWN"}if(typeof _debug=="function")_debug("Got pong idx = "+t+" on "+this.conId+": sent_at = "+r+", rcvd_at = "+i+" rt_time = "+s);return true};PSConFlash.prototype.cleanup=function(){this.rbuf="";if(this.respTimer!=null)window.clearTimeout(this.respTimer);if(this.pingTimer!=null)window.clearTimeout(this.pingTimer);for(var e=0;e<this.pongTimers.length;e++){if(this.pongTimers[e]!=null){window.clearTimeout(this.pongTimers[e])}}delete PSConFlash.consById[this.conId];return};PSConFlash.prototype.gotEvent=function(e,t){if(e=="DISCONNECTED"){this.cleanup()}else if(e=="BODY_DATA"){this.gotData(t);return}else if(e=="CONNECTED"){this.startPings()}else if(e=="DEBUG"){}var n=PSConFlash.eventQ.length==0;PSConFlash.eventQ.push([this,e,t]);if(n){window.setTimeout("PSConFlash.processEventQ()",0)}else{}return};PSConFlash.prototype.gotData=function(e){this.rbuf+=e;var t=0;var n=0;while(true){var r=ps_protocol_parse_msg(this.rbuf,t);n=r[0];if(n<=0){break}t=r[1];var i=r[2];if(i.type=="PONG"){var s=this.gotPong(i.ping_id);if(!s){this.gotEvent("MESSAGE",i)}}else{this.gotEvent("MESSAGE",i)}}this.rbuf=this.rbuf.substring(t);if(n<0){if(typeof _debug=="function")_debug("Bad message received - disconnecting.");this.disconnect("ERROR")}else if(this.respTimer!=null){if(typeof _debug=="function")_debug("Rescheduling reponse timer.");window.clearTimeout(this.respTimer);var o="PSConFlash.noResp('"+this.conId+"')";this.respTimer=window.setTimeout(o,PSConFlash.respTimeout)}};PSConFlash.processEventQ=function(){if(typeof _debug=="function")_debug("Processing PSCon event queue (size "+PSConFlash.eventQ.length+")");for(var e=0;e<PSConFlash.eventQ.length;e++){var t=PSConFlash.eventQ[e];var n=t[0];for(var r=0;r<n.listeners.length;r++){try{n.listeners[r].apply(null,t)}catch(i){if(typeof _debug=="function")_debug("PSConFlash listener failed with: "+i)}}if(t[1]=="DISCONNECTED"){n.listeners=[]}}PSConFlash.eventQ=[]};PSConAJAX.HCON_REQ_URL_PATH="/push";PSConAJAX.responseTimeout=80*1e3;PSConAJAX.consById={};PSConAJAX.nextConId=0;PSConAJAX.eventQ=[];PSConAJAX.pageInit=function(){if(_debug)_debug("Performing page initialisation for AJAX.")};PSConAJAX.prototype.connect=function(e,t){if(_debug)_debug("Connecting "+this.conId+" to "+e.debugStr());if(this.connectCalled){if(_debug)_debug("Cannot connect "+this.conId+"; already called connect().");disconnect("ERROR")}this.connectCalled=true;if(e.method!=this.method){if(_debug)_debug("Cannot connect "+this.conId+" to "+e.debugStr()+" with a "+this.method+" connection.");disconnect("ERROR")}this.server=e;if(window.XMLHttpRequest){this.xmlreq=new XMLHttpRequest}else if(window.ActiveXObject){this.xmlreq=new ActiveXObject("Microsoft.XMLHTTP")}if(!this.xmlreq){if(_debug)_debug("Cannot connect "+this.conId+"; unable to create XMLHttp object.");disconnect("UNSUPPORTED");return}PSConAJAX.consById[this.conId]=this;this.xmlreq.onreadystatechange=new Function("try { return PSConAJAX.stateChangeHandler('"+this.conId+"'); } catch (e) {}");if(e.port==80||isNaN(e.port)){var n="http://"+e.host}else if(e.port==443){var n="https://"+e.host}else{var n="http://"+e.host+":"+e.port}n+=PSConAJAX.HCON_REQ_URL_PATH;try{this.xmlreq.open("POST",n,true)}catch(r){if(_debug)_debug("Cannot open POST request for "+this.conId+"; "+r);this.disconnect("ERROR");return}this.responseTimer=window.setTimeout("PSConAJAX.timeoutHandler('"+this.conId+"');",PSConAJAX.responseTimeout);try{this.xmlreq.setRequestHeader("Content-Type","text/plain");if(_debug)_debug('Sending data "'+t+'"; on '+this.conId);this.xmlreq.send(t)}catch(r){if(_debug)_debug("Cannot send data for "+this.conId+"; "+r);this.disconnect("ERROR");return}this.gotEvent("CONNECTED","");return};PSConAJAX.prototype.disconnect=function(e){if(!e){e="DELIBERATE"}if(_debug)_debug("Disconnecting "+this.conId+" due to "+e);this.rbuf="";if(this.responseTimer!=null){window.clearTimeout(this.responseTimer);this.responseTimer=null}delete PSConAJAX.consById[this.conId];if(this.xmlreq){PSConAJAX.terminateXMLReq(this.xmlreq);this.xmlreq=null}this.gotEvent("DISCONNECTED",e);return};PSConAJAX.prototype.sendData=function(e){if(_debug)_debug("Cannot send data over "+this.conId+"; not possible with AJAX.");return false};PSConAJAX.prototype.addListener=function(e){this.listeners.push(e)};PSConAJAX.stateChangeHandler=function(e){var t=PSConAJAX.consById[e];if(!t){if(_debug)_debug("AJAX state change for stale connection "+e);return}var n=t.xmlreq;if(!n){if(_debug)_debug("AJAX state change for connection "+e+" whose xmlreq is null.");return}if(_debug)_debug("AJAX state change for connection "+e+"; readyState is now "+n.readyState);if(n.readyState!=4){return}var r;try{r=n.status;if(_debug)_debug("AJAX response status is '"+r+"' for connection "+e)}catch(i){if(_debug)_debug("Could not get AJAX response status "+"for connection "+e+"; "+i);r=""}if(r!=200){t.xmlreq=null;t.disconnect("ERROR");return}var s=n.responseText;if(_debug)_debug("Got AJAX response text '"+s+"' for connection "+e);try{t.xmlreq.onreadystatechange=null}catch(i){}t.xmlreq=null;t.gotEvent("BODY_DATA",s);t.disconnect("CLOSED");return};PSConAJAX.timeoutHandler=function(e){var t=PSConAJAX.consById[e];if(!t){if(_debug)_debug("Got timeout for stale connection "+e);return}if(_debug)_debug("Got timeout for connection "+e);t.disconnect("ERROR");return};PSConAJAX.terminateXMLReq=function(e){try{XMLreq.onreadystatechange=null}catch(t){}try{e.open("BOGUS","bogus://example.com/")}catch(t){}try{e.abort()}catch(t){}return};PSConAJAX.prototype.gotEvent=function(e,t){if(_debug)_debug("Got event from AJAX: "+this.conId+","+e+","+t);if(e=="BODY_DATA"){this.gotData(t);return}var n=PSConAJAX.eventQ.length==0;PSConAJAX.eventQ.push([this,e,t]);if(n){window.setTimeout("PSConAJAX.processEventQ()",1)}else{}return};PSConAJAX.prototype.gotData=function(e){this.rbuf+=e;var t=0;var n=0;while(true){var r=ps_protocol_parse_msg(this.rbuf,t);n=r[0];if(n<=0){break}t=r[1];var i=r[2];this.gotEvent("MESSAGE",i)}this.rbuf=this.rbuf.substring(t);if(n<0){if(_debug)_debug("Bad message received - disconnecting.");this.disconnect("ERROR")}};PSConAJAX.processEventQ=function(){if(_debug)_debug("Processing PSConAJAX event queue (size "+PSConAJAX.eventQ.length+")");for(var e=0;e<PSConAJAX.eventQ.length;e++){var t=PSConAJAX.eventQ[e];var n=t[0];for(var r=0;r<n.listeners.length;r++){try{n.listeners[r].apply(null,t)}catch(i){if(_debug)_debug("PSConAJAX listener failed with: "+i)}}if(t[1]=="DISCONNECTED"){n.listeners=[]}}PSConAJAX.eventQ=[];return};PSServer.prototype.debugStr=function(){return this.host+":"+this.port+" using "+this.method};ps_servers_listeners=[];var ps_servers_sorted=false;var ps_servers_available=[];var ps_servers_blacklisted=[];var ps_servers_methods_blacklisted={};ps_servers_fallback_methods={FLASH_URLSTREAM:true,AJAX:true};ps_servers_power_methods={FLASH_SOCK_NATIVE:true,FLASH_SOCK_HTTP:true};ps_servers_ranked_methods=["FLASH_SOCK_NATIVE","FLASH_SOCK_HTTP","FLASH_URLSTREAM","AJAX"];ps_servers_test_next_method_after=2;var ps_servers_fallback_delay_ms=2e3;var ps_servers_flash_ready_delay_ms=1e4;ps_servers_search_started_at=0;ps_servers_still_searching=true;ps_servers_test_max_time_ms=4e4;ps_servers_test_con=null;ps_servers_search_timer=null;ps_servers_flash_ready_timer=null;ps_protocol_CHANNEL_PATTERN=/^[A-Za-z0-9_]{16}$/;ps_protocol_CHANNEL_ID_SIZE=16;ps_protocol_MESSAGE_ID_SIZE=10;ps_protocol_MSG_LENGTH_SIZE=6;ps_protocol_PING_ID_SIZE=4;ps_protocol_AUTH_SIZE=4;ps_protocol_USER_ID_SIZE=10;PSPongResponse.prototype.debugStr=function(){return"pong #"+this.ping_id};PSPublishedMsg.prototype.debugStr=function(){return"msg #"+this.msg_id+" on "+this.channel+" from: "+this.user_id+" re: "+this.subject+' containing: "'+this.data+'"'};var _ps_client_started=false;var _ps_client_msg_listeners=[];var _ps_client_state_listeners=[];var _ps_client_channels={};var _ps_client_num_registrants=0;var _ps_client_registrants={};var _ps_client_auth_token="";var _ps_client_cached_subs_req=null;var _ps_client_rbuf="";var _ps_client_wbuf="";var _ps_client_wbuf_pending=0;var _ps_client_con=null;var _ps_client_status="NOT_STARTED";var _ps_client_recon_delay_ms=500;var _ps_client_recon_timer=null;var _ps_wrapper_drop_domain_for_re=/^(push|int)\./;var _ps_wrapper_parent_timeout_ms=2e4;var _ps_wrapper_parent_timer=null;var _ps_wrapper_parent_timed_out=false;var _ps_wrapper_max_debug_scollback_chars=5e3;var ps_wrapper_talkback_url=null
	</script>
</head>
<body onload="ps_wrapper_page_init()" marginwidth="0" marginheight="0">



	<object type="application/x-shockwave-flash" id="PSConManagerSWF" data="./PSConManagerSWF.swf.download" width="20" height="10"><param name="allowscriptaccess" value="always"><param name="bgcolor" value="#ffffff"></object>





</body></html>