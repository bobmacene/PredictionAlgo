/** * Copyright, all rights reserved.  * Dopamine Jackpot Banner 1.0.0  * Build at 2016-10-14 06:10:25 */console.log("%c [Dev Build] Dopamine Jackpot Banner v1.0.0.32 master#621038f ", "background: #222; color: #bada55");(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,a){for(var n=0;n<a.length;n++){var t=a[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(a,n,t){return n&&e(a.prototype,n),t&&e(a,t),a}}(),Config=require("./Config"),Utils=require("./utils/Utils"),JackpotAdapter=require("./jackpot/JackpotAdapter"),App=function(){function e(a){var n=this;_classCallCheck(this,e),this.config=new Config(a),this._loadJackpotPanel(function(){com.dopamine.ui.jackpotPanel.start({lang:n.config.lang,basePath:n.config.jackpotBasePath,canvas:document.getElementById("stageJackpotPanel")}),n.jackpot=new JackpotAdapter(n.config,com.dopamine.ui.jackpotPanel.API),$(window).resize(n.updateResize),n.updateResize(),n.config.bannerClickURL&&$(".hitArea").addClass("active").attr("href",n.config.bannerClickURL)})}return _createClass(e,[{key:"updateResize",value:function(){$("#stageJackpotPanel").css({width:window.innerWidth,height:window.innerHeight}),com.dopamine.ui.jackpotPanel.API.setOrientation(window.innerWidth>window.innerHeight?"portrait":"landscape"),com.dopamine.ui.jackpotPanel.API.updateResize()}},{key:"_loadJackpotPanel",value:function(e){var a=this;console.log("Load jackpot panel:",this.config),Utils.loadScript(this.config.jackpotBasePath+"vendor.js",function(){Utils.loadScript(a.config.jackpotBasePath+"game.min.js",function(){console.log("Jackpot panel is loaded"),e()})})}}]),e}();module.exports=App;
},{"./Config":2,"./jackpot/JackpotAdapter":3,"./utils/Utils":6}],2:[function(require,module,exports){
"use strict";function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}var CURRENCIES={GBP:"GBP|£|,|.",EUR:"EUR|€|,|.",USD:"USD|$|,|."},Config=function t(a){if(_classCallCheck(this,t),!a.jackpotId)throw Error("Missing required parameter: jackpotId");if(!a.feedURL)throw Error("Missing required parameter: feedURL");if(!a.jackpotBasePath)throw Error("Missing required parameter: jackpotBasePath");this.jackpotId=a.jackpotId,this.lang=a.lang||"en",this.bannerClickURL=a.bannerClickURL||null,this.buttonSkin=a.buttonSkin||"none";var e=(CURRENCIES[a.currency]||CURRENCIES.GBP).split("|");this.currency={code:e[0],symbol:e[1],thousand:e[2],decimal:e[3]},this.initialUpdateInterval=a.initialUpdateInterval||5,this.updateInterval=a.updateInterval||60,this.jackpotBasePath=a.jackpotBasePath,this.feedURL=a.feedURL};module.exports=Config;
},{}],3:[function(require,module,exports){
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),Parser=require("./Parser"),JackpotAPI=null,JackpotAdapter=function(){function t(e,a){_classCallCheck(this,t),this.cfg=e,JackpotAPI=a,JackpotAPI.setOrientation("landscape"),JackpotAPI.on(JackpotAPI.events.JACKPOT_PANEL_READY,function(){this.isPanelReady=!0,this._onJackpotReady()},this),this._getData(function(t,e){this._initialData=e,this._onJackpotReady()}.bind(this))}return _createClass(t,[{key:"_onJackpotReady",value:function(){if(this._initialData&&this.isPanelReady){var t=Parser.parse(this._initialData.pots),e=this._initialData.jackpotId;if(!(t&&t.pots&&t.pots.length))return console.warn("No jackpots are returned from the game!");if(e!==this.cfg.jackpotId)return console.error('Wrong jackpot combination: the server pass "'+e+'", but the jackpot panel expect "'+this.cfg.jackpotId+'"');JackpotAPI.setCurrencyFormat(this.cfg.currency.code,this.cfg.currency.symbol,this.cfg.currency.thousand,this.cfg.currency.decimal),JackpotAPI.setJackpots(t.pots,e),JackpotAPI.start(),this.cfg.buttonSkin&&"none"!==this.cfg.buttonSkin&&JackpotAPI.setSkin(this.cfg.buttonSkin),JackpotAPI.on(JackpotAPI.events.JACKPOT_REQUEST_UPDATE,function(){this._autoUpdate(0)},this),this._autoUpdate(this.cfg.initialUpdateInterval)}}},{key:"_autoUpdate",value:function(t){this._timeout&&(clearTimeout(this._timeout),this._timeout=null),this._timeout=setTimeout(function(){this._getData(function(t,e){this._jackpotUpdate(e),this._autoUpdate(this.cfg.updateInterval)}.bind(this))}.bind(this),1e3*t)}},{key:"_getData",value:function(t){var e=this.cfg.feedURL+this.cfg.jackpotId+"?currency="+this.cfg.currency.code;$.getJSON(e,function(e){console.log(e),e&&e.success&&e.result&&e.result.jackpots?t(null,e.result.jackpots):(console.warn("Error, missing data",e),t("ERROR!",e))}.bind(this))}},{key:"_jackpotUpdate",value:function(t){var e=Parser.parse(t.pots);JackpotAPI.update(e.notWonPots,this.cfg.updateInterval,e.pots,t.competingUsers),e.otherUserWins.length&&JackpotAPI.someoneWins(e.otherUserWins)}}]),t}();module.exports=JackpotAdapter;
},{"./Parser":4}],4:[function(require,module,exports){
"use strict";function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(i,t,n){return t&&e(i.prototype,t),n&&e(i,n),i}}(),Parser=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"parse",value:function(e){var i=this._parseWins(e);this._adaptJackpots(i.pots,i.userWins,i.otherUserWins);var t=_.pluck([].concat(i.userWins,i.otherUserWins),"id"),n=_.reject(i.pots,function(e){return _.contains(t,e.id)});return{pots:i.pots,userWins:i.userWins,otherUserWins:i.otherUserWins,notWonPots:n}}},{key:"_parseWins",value:function(e){for(var i=[],t=[],n=0;n<e.length;n++){var d=e[n];d.win&&i.push({id:d.id,resetAmount:d.amount,winAmount:d.win,state:d.state,type:d.type});var r=_.findWhere(this.pots,{id:e[n].id});if(r&&!r.win&&r.prevWinTime!==d.prevWinTime){var s=d.win?d.win:d.amount;t.push({id:d.id,resetAmount:s,winAmount:d.prevWinAmount,state:d.state,type:d.type})}}return this.pots=e,{pots:_.deepClone(this.pots),userWins:i,otherUserWins:t}}},{key:"_adaptJackpotIds",value:function(e,i,t){200==e.id&&(i?e.id=121:t&&(e.id=3001)),2011!=e.id&&2021!=e.id||(e.id=2001),2012!=e.id&&2022!=e.id||(e.id=2002),2013!=e.id&&2023!=e.id||(e.id=2003),2014!=e.id&&2024!=e.id||(e.id=2004)}},{key:"_adaptJackpots",value:function(e,i,t){if(!e||!e.length||void 0===e[0].time)return console.warn("Jackpot: Still using the old backend API");var n=_.findWhere(e,{id:122})||_.findWhere(e,{id:123}),d=_.findWhere(e,{id:3002})||_.findWhere(e,{id:3003});_.each(e,function(e){this._adaptJackpotIds(e,n,d),e.startTime=e.time.started,e.periodsTime=e.time.periods,e.targetTime=e.time.target,e.endTime=e.time.ended,e.currentTime=e.time.current,e.hiddenTime=e.time.hidden,delete e.time},this),_.each(i,function(e){this._adaptJackpotIds(e,n,d)},this),_.each(t,function(e){this._adaptJackpotIds(e,n,d)},this);var r=_.findWhere(e,{type:"time",state:"active"});if(r&&(console.info("#Adapt: there is active timepot"),this._cachedTimeId&&(console.log("Changing timePot id from "+r.id+" to "+this._cachedTimeId),r.id=this._cachedTimeId),r.hiddenTime)){console.info("#Adapt: there is hiddenTime:");var s=r.hiddenTime===r.currentTime||moment(r.hiddenTime).isAfter(r.currentTime);if(s){console.info("#Adapt: the prev won time should be displayed during hidden time. We will create dummy ended jackpot pot");var a={id:null,name:"dummy",type:"time",state:"ended",amount:0,prevWinAmount:r.prevWinAmount,prevWinTime:r.prevWinTime,targetAmount:null,startTime:null,periodsTime:null,targetTime:null,endTime:null,currentTime:r.currentTime,hiddenTime:null},o=i&&i.length&&_.findWhere(i,{type:"time"}),u=t&&t.length&&_.findWhere(t,{type:"time"});o||u?(console.info("#Adapt: the timepot was won and we should adapt the time and dummy ids too"),a.id=r.id,r.id+=100,this._cachedDummyId=a.id,this._cachedTimeId=r.id,o&&(o.id=a.id,o.state="ended"),u&&(u.id=a.id,u.state="ended")):a.id=this._cachedDummyId||r.id+1e5,e.push(a)}}}}]),e}();module.exports=Parser;
},{}],5:[function(require,module,exports){
"use strict";"undefined"==typeof $&&console.error("#App - missing required library: jQuery"),"undefined"==typeof _&&console.error("#App - missing required library: Underscore.js");var App=require("./App"),Utils=require("./utils/Utils");$(function(){var e=window.com=window.com||{};e.dopamine=e.dopamine||{},e.dopamine.app=App,e.dopamine.utils=Utils,console.log("#App exported to: com.dopamine.app")});
},{"./App":1,"./utils/Utils":6}],6:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Utils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"parseURLParams",value:function(){for(var e=window.location.search.substring(1),t=e.split("&"),n={},r=0;r<t.length;r++){var a=t[r].split("=");n[a[0]]=a[1]}return n}},{key:"loadScript",value:function(e,t){var n=document.createElement("script");n.setAttribute?n.setAttribute("src",e):n.src=e,t&&(n.onload=t),document.getElementsByTagName("body")[0].appendChild(n)}}]),e}();module.exports=Utils;
},{}]},{},[5])


//# sourceMappingURL=app.min.map